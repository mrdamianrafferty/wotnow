(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{7258:(e,t,n)=>{"use strict";function i(e,t){console.debug('Evaluating single condition: "'.concat(e,'" against weather:'),t);let n={temp:"temperature",rain:"precipitation",wind_speed:"windSpeed"},i=e.match(/^([a-zA-Z_]+)=(-?\d+(?:\.\d+)?)\.\.(-?\d+(?:\.\d+)?)$/);if(i){let[,e,r,a]=i,o=parseFloat(r),s=parseFloat(a),l=n[e]||e,c="number"==typeof t[l]?t[l]:null;return null!==c&&c>=o&&c<=s}let r=e.match(/^([a-zA-Z_]+)([<>=!]+)([0-9.]+)$/);if(!r)return!1;let[,a,o,s]=r,l=parseFloat(s),c=n[a]||a,d="number"==typeof t[c]?t[c]:null;if(null===d)return!1;switch(o){case"<":return d<l;case"<=":return d<=l;case">":return d>l;case">=":return d>=l;case"=":case"==":return d===l;case"!=":return d!==l;default:return!1}}function r(e){let{forecast:t=[],interests:n=[],activities:r=[]}=e;if(console.debug("getSuggestionsByDay called with:",{forecast:t,interests:n,activities:r}),!Array.isArray(r)){if(console.error("\uD83D\uDEA8 activities argument is not an array. Received:",r),!(r&&Array.isArray(r.activities)))return[];console.warn("⚠️ Unwrapping activities.activities property"),r=r.activities}return Array.isArray(t)?t.map(e=>{let t=e.weather||{},a=[],o=[],s=[],l=[];r.forEach(r=>{let c=n.includes(r.id),d="Outdoor"===r.secondaryCategory,u="Indoor"===r.secondaryCategory;if(!c)return;let h=new Date(e.date).getMonth()+1;if(r.seasonalMonths&&!r.seasonalMonths.includes(h))return void console.debug("Activity '".concat(r.id,"' skipped because it is out of season."));if(d){let e=!1;if(r.poorConditions&&r.poorConditions.length>0&&(e=r.poorConditions.some(e=>{let n=i(e,t);return console.debug("Checking poor condition '".concat(e,"' for activity '").concat(r.id,"': ").concat(n)),n})))return void console.debug("Activity '".concat(r.id,"' skipped due to poor condition."));let n=!1;if(r.perfectConditions&&r.perfectConditions.length>0&&(n=r.perfectConditions.every(e=>{let n=i(e,t);return console.debug("Checking perfect condition '".concat(e,"' for activity '").concat(r.id,"': ").concat(n)),n}))){console.debug("Activity '".concat(r.id,"' added as perfect.")),a.push({activityId:r.id,evaluation:"perfect"});return}let l=!1;if(r.goodConditions&&r.goodConditions.length>0){let e=r.goodConditions.filter(e=>{let n=i(e,t);return console.debug("Checking good condition '".concat(e,"' for activity '").concat(r.id,"': ").concat(n)),n}).length;if(e/r.goodConditions.length>=.33){l=!0,console.debug("Activity '".concat(r.id,"' added as good (passed ").concat(e,"/").concat(r.goodConditions.length,").")),o.push({activityId:r.id,evaluation:"good"});return}}if(!n&&!l&&!e){console.debug("Activity '".concat(r.id,"' added as acceptable.")),o.push({activityId:r.id,evaluation:"acceptable"});return}r.indoorAlternative&&s.push(r.indoorAlternative)}else u&&l.push({activityId:r.id,evaluation:"indoor"})});let c=[...a,...o];if(c.length<10&&s.length>0)for(let e of s){let t=r.find(t=>t.name===e);if(t&&(c.push({activityId:t.id,evaluation:"indoorAlternative"}),c.length>=10))break}if(c.length<10&&l.length>0){for(let e of l)if(c.push(e),c.length>=10)break}return{date:e.date,suggestions:c.slice(0,10)}}):(console.error("\uD83D\uDEA8 forecast argument is not an array. Received:",t),[])}n.d(t,{p:()=>r})},8587:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var i=n(7876),r=n(4232),a=n(7258),o=n(3663),s=n(3974);let l=function(){let e=new Date,t=new Date;t.setMonth(e.getMonth()+3),e.toISOString().split("T")[0],t.toISOString().split("T")[0];let{preferences:n,setPreferences:l}=(0,s.HW)(),c=n.location,d=n.interests||[],u=n.venues||[],[h,g]=(0,r.useState)((null==c?void 0:c.name)||""),[m,p]=(0,r.useState)([]),[f,y]=(0,r.useState)(n.gigsCategory||"Music"),[v,x]=(0,r.useState)(n.gigsGenre||""),j=async()=>{try{let e=await fetch("https://api.openweathermap.org/geo/1.0/direct?q=".concat(encodeURIComponent(h),"&limit=1&appid=").concat((void 0).NEXT_PUBLIC_OPENWEATHER_KEY)),t=await e.json();if(t&&t.length>0){let{lat:e,lon:i}=t[0];l({...n,location:{name:h,lat:e,lon:i}})}else l({...n,location:{name:h}})}catch(e){l({...n,location:{name:h}})}},[b,w]=(0,r.useState)([]);if((0,r.useEffect)(()=>{!async function(){try{var e,t;let n=null!=(e=null==c?void 0:c.lat)?e:40.4168,i=null!=(t=null==c?void 0:c.lon)?t:-3.7038,r=await fetch("https://api.openweathermap.org/data/2.5/forecast?lat=".concat(n,"&lon=").concat(i,"&units=metric&appid=").concat("748bd0822b74e58605964652c38d0796")),a=await r.json(),o={};a.list.forEach(e=>{var t;let n=e.dt_txt.split(" ")[0];o[n]||(o[n]={entries:[],totalRain:0}),o[n].entries.push(e),(null==(t=e.rain)?void 0:t["3h"])&&(o[n].totalRain+=e.rain["3h"])});let s=Object.entries(o).slice(0,5).map(e=>{var t,n,i,r,a,o;let[s,{entries:l,totalRain:c}]=e,d=l.find(e=>e.dt_txt.includes("12:00:00"))||l[0],u=l.filter(e=>{var t;return(null==(t=e.rain)?void 0:t["3h"])&&Math.round(e.rain["3h"])>0}).map(e=>{let t=new Date(e.dt_txt).getHours();return"".concat(t,":00 ").concat(Math.round(e.rain["3h"]),"mm")});return{date:s,tempMax:Math.round(d.main.temp_max),tempMin:Math.round(d.main.temp_min),temperature:Math.round(d.main.temp),condition:d.weather[0].main,description:d.weather[0].description,icon:d.weather[0].icon,wind_speed:Math.round(3.6*d.wind.speed),rain:Math.round(null!=(r=null==(t=d.rain)?void 0:t["3h"])?r:0),snow:(null==(n=d.snow)?void 0:n["3h"])?Math.round(d.snow["3h"]):0,clouds:null!=(a=null==(i=d.clouds)?void 0:i.all)?a:null,humidity:d.main.humidity,visibility:null!=(o=d.visibility)?o:null,totalRain:Math.round(c),rainDetails:u}});w(s)}catch(e){console.error("Error fetching data:",e)}}()},[c]),(0,r.useEffect)(()=>{!async function(){try{let e=new URLSearchParams;e.append("city",(null==c?void 0:c.name)||""),f&&e.append("category",f),"Music"===f&&v&&e.append("genre",v),u.length>0&&e.append("venues",u.join(","));let t=await fetch("/api/gigs?".concat(e.toString())),n=await t.json();p(n||[])}catch(e){console.error("Error fetching gigs:",e)}}()},[c,f,v,u]),!b)return(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{children:"Loading forecast data…"}),(0,i.jsx)("p",{children:"Please wait while we fetch the latest weather information."})]});if(0===b.length)return(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{children:"No forecast data available."}),(0,i.jsx)("p",{children:"We couldn't retrieve any forecast data. Please try again later or check your connection."})]});let S=Array.from(new Set(m.filter(e=>"Music"===e.category&&Array.isArray(e.genres)).flatMap(e=>e.genres))),A=m.filter(n=>!!n.date&&(()=>{let i=new Date(n.date);return i>=e&&i<=t})()&&("All"===f||n.category===f)&&("Music"!==f||!v||Array.isArray(n.genres)&&n.genres.includes(v))),C=e.toISOString().split("T")[0],D=t.toISOString().split("T")[0],N={Music:"KZFzniwnSyZfZ7v7nJ","Arts & Theatre":"KZFzniwnSyZfZ7v7na",Sports:"KZFzniwnSyZfZ7v7nE",All:""},M={};return S.forEach(e=>{M[e]=e}),(0,i.jsxs)("section",{children:[(0,i.jsxs)("header",{className:"site-header",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"page-title",children:"WotNow"}),(0,i.jsx)("p",{className:"page-subtitle",children:(0,i.jsx)("a",{href:"/interests",children:"What are you into?"})})]}),(0,i.jsxs)("div",{className:"location-input",children:[(0,i.jsx)("span",{children:"Location: "}),(0,i.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),placeholder:"Enter city name"}),(0,i.jsx)("button",{onClick:j,children:"Save"})]})]}),(0,i.jsx)("section",{className:"main-grid",children:b.map((e,t)=>{var n,r,s,l,c,u,h;let g={temperature:null!=(r=e.temperature)?r:Math.round((e.tempMin+e.tempMax)/2),precipitation:null!=(s=e.rain)?s:0,windSpeed:null!=(l=e.wind_speed)?l:0,water_temp:null,clouds:null!=(c=e.clouds)?c:null},m=o.b;console.log("Filtered activities:",m),console.log("Weather for",e.date,":",g);let p=null!=(u=null==(n=(m.length>0?(0,a.p)({activities:m,interests:d,forecast:[{date:e.date,weather:g}]}):[])[0])?void 0:n.suggestions)?u:[];console.log("Suggestions for",e.date,":",p);let f=e.rainDetails.length>0?(0,i.jsx)(i.Fragment,{children:e.rainDetails.map(e=>{let t=e.match(/^(\d+):\d+\s+(\d+)mm$/);if(!t)return e;let n=parseInt(t[1],10),i=t[2];return 0===n?"".concat(i,"mm around midnight"):12===n?"".concat(i,"mm around noon"):"".concat(i,"mm around ").concat(n%12==0?12:n%12," ").concat(n<12?"AM":"PM")}).join(", ")}):null;return(0,i.jsxs)("article",{className:"homepage-card",children:[(0,i.jsxs)("header",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"card-title",style:{margin:0},children:0===t?"Today":1===t?"Tomorrow":new Date(e.date).toLocaleDateString("en-GB",{weekday:"long"})}),(0,i.jsx)("div",{className:"card-date",style:{fontSize:"0.9rem"},children:new Date(e.date).toLocaleDateString("en-GB",{day:"numeric",month:"long"})})]}),(0,i.jsxs)("div",{className:"card-condition",style:{fontSize:"1.2rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontSize:"4rem",marginRight:"0.5rem"},children:function(e){switch(e.toLowerCase()){case"sunny":case"clear":return"☀️";case"rain":return"\uD83C\uDF27️";case"cloudy":case"clouds":return"☁️";case"snow":return"❄️";case"thunderstorm":return"⛈️";case"fog":case"mist":return"\uD83C\uDF2B️";case"drizzle":return"\uD83C\uDF26️";default:return"❔"}}(e.condition)}),(0,i.jsx)("span",{style:{fontSize:"1rem",fontWeight:"normal",textTransform:"capitalize"},children:e.description})]})]}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsxs)("div",{className:"temperature",style:{fontSize:"2rem",fontWeight:"bold"},children:[e.temperature,"\xb0C"]}),e.totalRain>0&&(0,i.jsxs)("div",{className:"rain-summary",children:["\uD83C\uDF27️ ",e.totalRain,"mm expected (",f,")"]}),(0,i.jsxs)("div",{className:"weather-stats",children:["\uD83D\uDCA8 ",e.wind_speed," km/h | ☁️ ",e.clouds,"% | \uD83D\uDCA7 ",e.humidity,"% | \uD83D\uDD0D ",Math.round((null!=(h=e.visibility)?h:1e4)/1e3)," km"]})]}),(0,i.jsx)("div",{className:"card-suggestions",style:{marginTop:"0.25rem"},children:p.length>0?(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Suggestions:"})," ",p.slice(0,5).map((e,t)=>{let n=o.b.find(t=>t.id===e.activityId);return(null==n?void 0:n.name)||e.activityId}).filter(Boolean).join(", ")]}):(0,i.jsxs)("p",{children:["No suggestions match your current interests for this day. ",(0,i.jsx)("a",{href:"/interests",children:"Add more interests"})," to get better suggestions!"]})})]},e.date)})}),(0,i.jsxs)("section",{children:[(0,i.jsx)("nav",{"aria-label":"Event categories",className:"category-tabs",style:{marginBottom:"1rem",marginTop:"2rem"},children:["Music","Arts & Theatre","Sports","All"].map(e=>(0,i.jsx)("button",{type:"button",onClick:()=>{y(N[e]||""),x("")},style:{marginRight:"0.5rem",padding:"0.5rem 1rem",border:f===(N[e]||"")?"2px solid #0070f3":"1px solid #ccc",background:f===(N[e]||"")?"#eef6ff":"#fff",cursor:"pointer",borderRadius:"4px"},"aria-pressed":f===(N[e]||""),children:e},e))}),"KZFzniwnSyZfZ7v7nJ"===f&&(0,i.jsxs)("nav",{"aria-label":"Music genres",className:"genre-tabs",style:{marginBottom:"1rem"},children:[(0,i.jsx)("button",{type:"button",onClick:()=>x(""),style:{marginRight:"0.5rem",padding:"0.3rem 0.8rem",border:v?"1px solid #ccc":"2px solid #0070f3",background:v?"#fff":"#eef6ff",cursor:"pointer",borderRadius:"4px",fontSize:"0.85rem"},"aria-pressed":!v,children:"All Genres"}),S.map(e=>(0,i.jsx)("button",{type:"button",onClick:()=>x(M[e]||""),style:{marginRight:"0.5rem",padding:"0.3rem 0.8rem",border:v===(M[e]||"")?"2px solid #0070f3":"1px solid #ccc",background:v===(M[e]||"")?"#eef6ff":"#fff",cursor:"pointer",borderRadius:"4px",fontSize:"0.85rem"},"aria-pressed":v===(M[e]||""),children:e},e))]}),(0,i.jsxs)("section",{"aria-labelledby":"upcoming-gigs-heading",children:[(0,i.jsx)("h2",{id:"upcoming-gigs-heading",children:"Upcoming Gigs and Events"}),(0,i.jsxs)("div",{className:"date-range",style:{marginBottom:"1rem"},children:["Showing events from ",(0,i.jsx)("time",{dateTime:C,children:e.toLocaleDateString()})," to ",(0,i.jsx)("time",{dateTime:D,children:t.toLocaleDateString()})]}),A.length>0?(0,i.jsx)("ul",{className:"gigs-list",style:{listStyle:"none",padding:0},children:A.slice(0,10).map((e,t)=>{var n,r;return(0,i.jsxs)("li",{className:"gig-item",style:{marginBottom:"1rem",padding:"0.75rem",border:"1px solid #ddd",borderRadius:"4px",background:"#fff"},children:[(0,i.jsx)("h3",{style:{fontSize:"1.1rem"},children:(null==(n=e.artist)?void 0:n.trim())||"Unknown Artist"}),(0,i.jsxs)("p",{style:{fontSize:"0.9rem",color:"#555"},children:["\uD83D\uDCC5 ",(0,i.jsx)("time",{dateTime:e.dateISO||"",children:e.date||"N/A"})," | \uD83D\uDCCD ",(null==(r=e.venue)?void 0:r.trim())||"N/A"]}),Array.isArray(e.genres)&&e.genres.length>0?(0,i.jsx)("div",{style:{marginTop:"0.25rem"},children:e.genres.map((e,t)=>(0,i.jsx)("span",{className:"badge genre-badge",style:{display:"inline-block",marginRight:"0.25rem",padding:"0.2rem 0.4rem",background:"#0070f3",color:"#fff",borderRadius:"3px",fontSize:"0.75rem"},children:e||"N/A"},t))}):(0,i.jsx)("div",{style:{marginTop:"0.25rem",fontSize:"0.85rem",color:"#777"},children:"\uD83C\uDFB5 Genres: N/A"})]},t)})}):(0,i.jsxs)("p",{style:{marginTop:"1rem"},children:["No gigs or events found for your preferences in this date range.",(0,i.jsx)("br",{}),(0,i.jsx)("a",{href:"/venues",children:"Select your favourite venues"})," or adjust your filters to see more suggestions."]})]})]})]})}},9772:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dev-gigs",function(){return n(8587)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[663,636,593,792],()=>t(9772)),_N_E=e.O()}]);