(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[648],{2084:(e,n,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/venues",function(){return t(3955)}])},3955:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});var a=t(7876),s=t(4232),r=t(3974);let l=()=>{var e;let{preferences:n,setPreferences:t}=(0,r.HW)(),[l,i]=(0,s.useState)((null==(e=n.location)?void 0:e.name)||""),[o,c]=(0,s.useState)(n.venues||[]),[u,d]=(0,s.useState)(n.genres||[]),[h,v]=(0,s.useState)(n.segment||"Music"),[g,m]=(0,s.useState)(""),[p,f]=(0,s.useState)([]),[x,j]=(0,s.useState)(!1),[y,S]=(0,s.useState)(""),k=(e,n,t)=>{t(n.includes(e)?n.filter(n=>n!==e):[...n,e])},w=async(e,n)=>{let t="string"==typeof e?e:l,a="string"==typeof n?n:h;if(!t.trim()||"current location"===t.trim().toLowerCase())return void S("Please enter a valid city name.");j(!0),S("");try{let e=new URLSearchParams({city:t});a&&"All"!==a&&e.append("category",a);let n=await fetch("/api/getVenues?".concat(e.toString()));if(!n.ok)throw Error("Server returned ".concat(n.status));let s=await n.json();s.venues?f(s.venues.map(e=>({id:e.id,name:e.name}))):(f([]),S(s.error||"No venues found."))}catch(e){console.error(e),S("Failed to fetch venues.")}finally{j(!1)}};return(0,s.useEffect)(()=>{var e;(null==(e=n.location)?void 0:e.name)&&i(n.location.name),n.segment&&v(n.segment),n.venues&&c(n.venues),n.genres&&d(n.genres)},[n]),(0,s.useEffect)(()=>{c(o.filter(e=>p.some(n=>n.name===e)))},[p]),(0,a.jsxs)("div",{className:"venues-page",children:[(0,a.jsx)("h1",{children:"Where do you go for a good time?"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{children:"City or Town: "}),(0,a.jsx)("input",{type:"text",value:l,onChange:e=>i(e.target.value),placeholder:"Enter your city"}),(0,a.jsx)("button",{onClick:()=>w(),disabled:x,children:x?"Loading…":"Update Venues"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{children:"Keep an eye on your favourite venues"}),(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",checked:p.length>0&&o.length===p.length,indeterminate:o.length>0&&o.length<p.length?"true":void 0,onChange:e=>{e.target.checked?c(p.map(e=>e.name)):c([])}}),"Select All"]}),x?(0,a.jsx)("p",{children:"Loading venues…"}):y?(0,a.jsx)("p",{style:{color:"red"},children:y}):0===p.length?(0,a.jsx)("p",{children:"No venues available. Enter a location."}):p.map(e=>(0,a.jsxs)("label",{children:[(0,a.jsx)("input",{type:"checkbox",checked:o.includes(e.name),onChange:()=>k(e.name,o,c)}),e.name]},e.id))]}),(0,a.jsx)("button",{onClick:()=>{t({...n,location:{name:l},venues:o,genres:u,segment:h}),m("Preferences saved!"),setTimeout(()=>m(""),3e3)},children:"Save Preferences"}),g&&(0,a.jsx)("p",{children:g})]})}}},e=>{var n=n=>e(e.s=n);e.O(0,[636,593,792],()=>n(2084)),_N_E=e.O()}]);