(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{142:(e,t,a)=>{"use strict";function n(e,t){if(null==t[function(e){let t=e.match(/^([a-zA-Z_]+)=(-?\d+(?:\.\d+)?)\.\.(-?\d+(?:\.\d+)?)/);if(t)return t[1];let a=e.match(/^([a-zA-Z_]+)[<>=!]=?/);return a?a[1]:e}(e)])return!0;let a=function(e){let t=e.match(/^([a-zA-Z_]+)=(-?\d+(?:\.\d+)?)\.\.(-?\d+(?:\.\d+)?)/);if(t)return{key:t[1],operator:"range",min:parseFloat(t[2]),max:parseFloat(t[3])};let a=e.match(/^([a-zA-Z_]+)([<>=!]=?|==)(-?\d+(?:\.\d+)?)/);return a?{key:a[1],operator:a[2],value:parseFloat(a[3])}:null}(e);if(!a)return!1;let n=t[a.key];if(null==n)return!1;if("range"===a.operator)return n>=a.min&&n<=a.max;switch(a.operator){case">":return n>a.value;case">=":return n>=a.value;case"<":return n<a.value;case"<=":return n<=a.value;case"=":case"==":return n===a.value;case"!=":return n!==a.value;default:return console.warn("Unknown operator: ".concat(a.operator)),!1}}function s(e){let{forecast:t=[],interests:a=[],activities:s=[]}=e;return Array.isArray(s)&&Array.isArray(t)?t.map(e=>{let t=Array.isArray(e.marine)&&e.marine.length>0?e.marine[0]:{},i={...e.weather,...t},r=new Date(e.date).getMonth()+1,o=s.filter(e=>a.includes(e.id)&&(!e.seasonalMonths||e.seasonalMonths.includes(r))),l=[],c=[],d=[],u=[];for(let e of o){let{id:t,weatherSensitive:a,indoorAlternative:s}=e,r=function(e,t){var a,s,i;return!1===e.weatherSensitive?"indoor":(null==(a=e.poorConditions)?void 0:a.some(e=>n(e,t)))?"excluded":(null==(s=e.perfectConditions)?void 0:s.length)&&e.perfectConditions.every(e=>n(e,t))?"perfect":(null==(i=e.goodConditions)?void 0:i.length)&&e.goodConditions.every(e=>n(e,t))?"good":e.goodConditions&&0!==e.goodConditions.length||e.perfectConditions&&0!==e.perfectConditions.length?"excluded":"acceptable"}(e,i);"excluded"!==r&&("perfect"===r?l.push({activityId:t,evaluation:"perfect"}):"good"===r?c.push({activityId:t,evaluation:"good"}):"acceptable"===r?c.push({activityId:t,evaluation:"acceptable"}):"indoor"===r&&u.push({activityId:t,evaluation:"indoor"}),a&&s&&d.push(s))}let g=[],v=new Set;function m(e){for(let t of e)!v.has(t.activityId)&&g.length<10&&(v.add(t.activityId),g.push(t))}if(m(l),m(c),g.length<10&&d.length>0)for(let e of d){let t=s.find(t=>t.id===e||t.name===e);if(t&&!v.has(t.id)&&(g.push({activityId:t.id,evaluation:"indoorAlternative"}),v.add(t.id),g.length>=10))break}if(g.length<10){for(let e of u)if(!v.has(e.activityId)&&(g.push(e),v.add(e.activityId),g.length>=10))break}return{date:e.date,suggestions:g}}):[]}a.d(t,{p:()=>s})},1330:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var n=a(7876),s=a(4232),i=a(7831),r=a(142),o=a(3956);let l={live_music:{label:"Live Music",category:103,format:6},music_festivals:{label:"Music Festivals",category:103,format:7},dj_dance:{label:"DJ / Dance Events",category:103,format:5,keywords:"DJ OR dance OR club"},local_music:{label:"Local Music Scene",category:103,format:6,radius:"25km"},theatre_performance:{label:"Theatre & Performance",category:105,keywords:"theatre OR play OR drama"},comedy_entertainment:{label:"Comedy & Entertainment",category:105,format:5,keywords:"comedy OR stand-up OR improv"},art_exhibitions:{label:"Art Exhibitions",category:105,keywords:"exhibition OR gallery"},dance_movement:{label:"Dance & Movement",category:105,format:6,keywords:"dance OR ballet OR contemporary"},film_media:{label:"Film & Media",category:104,format:9},competitive_sports:{label:"Competitive Sports",category:108,format:12},fitness_wellness:{label:"Fitness & Wellness",category:107,format:11},running_cycling:{label:"Running & Cycling",category:108,format:12,keywords:"run OR cycle OR marathon"},outdoor_adventures:{label:"Outdoor Adventures",category:109,format:11},team_sports_social:{label:"Team Sports Social",category:108,format:4,keywords:"football OR basketball OR volleyball"}};function c(){var e,t,a,c,d,u;let{preferences:g,setPreferences:v}=(0,i.HW)(),m=g.location,h=g.interests||[],p=(null==m?void 0:m.name)||"Berlin",[f,_]=(0,s.useState)(p),[y,b]=(0,s.useState)([]),[x,w]=(0,s.useState)({}),[j,N]=(0,s.useState)(!1),[k,S]=(0,s.useState)(!1),C=[...null!=(c=null==(e=g.eventPreferences)?void 0:e.musicCategories)?c:[],...null!=(d=null==(t=g.eventPreferences)?void 0:t.artsCategories)?d:[],...null!=(u=null==(a=g.eventPreferences)?void 0:a.sportsCategories)?u:[]];async function O(e){e.preventDefault();try{let e="https://api.openweathermap.org/geo/1.0/direct?q=".concat(encodeURIComponent(f),"&limit=1&appid=").concat("748bd0822b74e58605964652c38d0796"),t=await fetch(e).then(e=>e.json());if(t[0]){let{lat:e,lon:a,country:n}=t[0];v(t=>({...t,location:{name:f,lat:e,lon:a,countryCode:n}}))}}catch(e){}}(0,s.useEffect)(()=>{S(!0)},[]),(0,s.useEffect)(()=>{!async function(){try{var e,t;let a=null!=(e=null==m?void 0:m.lat)?e:52.52,n=null!=(t=null==m?void 0:m.lon)?t:13.405,s=await fetch("https://api.openweathermap.org/data/2.5/forecast?lat=".concat(a,"&lon=").concat(n,"&units=metric&appid=").concat("748bd0822b74e58605964652c38d0796")),i=await s.json(),r={};i.list.forEach(e=>{let t=e.dt_txt.split(" ")[0];r[t]||(r[t]=[]),r[t].push(e)});let o=Object.entries(r).slice(0,5).map(e=>{var t,a,n;let[s,i]=e,r=i.find(e=>e.dt_txt.includes("12:00:00"))||i[0];return{date:s,temp:Math.round(r.main.temp),tempMax:Math.round(r.main.temp_max),tempMin:Math.round(r.main.temp_min),condition:r.weather[0].main,windSpeed:Math.round(3.6*r.wind.speed),rain:Math.round((null==(t=r.rain)?void 0:t["3h"])||0),clouds:null!=(n=null==(a=r.clouds)?void 0:a.all)?n:0}});b(o)}catch(e){console.error("Failed to fetch forecast:",e)}}()},[m]),(0,s.useEffect)(()=>{!async function(){if(!p||0===C.length)return;N(!0);let e={};for(let t of C){let a=l[t];if(!a)continue;let n=new URLSearchParams({city:p,category:String(a.category)});a.format&&n.set("format",String(a.format)),a.keywords&&n.set("keywords",a.keywords),n.set("radius",a.radius||"100km");try{let a=await fetch("/api/events?".concat(n.toString())),s=await a.json();Array.isArray(s.events)?e[t]=s.events:e[t]=[]}catch(a){e[t]=[]}}w(e),N(!1)}()},[p,C.join(",")]);let E=y.map(e=>{var t;let a={temperature:e.temp,precipitation:e.rain,windSpeed:e.windSpeed,water_temp:null,clouds:e.clouds},n=(0,r.p)({forecast:[{date:e.date,weather:a}],interests:h,activities:o.b});return{date:e.date,emoji:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.toLowerCase();return t.includes("sun")||"clear"===t?"☀️":t.includes("rain")?"\uD83C\uDF27️":t.includes("snow")?"❄️":t.includes("cloud")?"☁️":t.includes("thunderstorm")?"⛈️":"\uD83C\uDF24️"}(e.condition),description:e.condition,suggestions:(null==(t=n[0])?void 0:t.suggestions)||[]}});return k?(0,n.jsxs)("main",{className:"devgigs",children:[(0,n.jsx)("h1",{className:"devgigs__title",children:"WotNow: Suggestions & Upcoming Events"}),(0,n.jsxs)("section",{className:"devgigs__section devgigs__section--location",children:[(0,n.jsx)("h2",{children:"Location"}),(0,n.jsxs)("form",{className:"devgigs__location-form",onSubmit:O,children:[(0,n.jsx)("input",{className:"devgigs__location-input",value:f,onChange:e=>_(e.target.value),placeholder:"Enter city or town"}),(0,n.jsx)("button",{className:"devgigs__location-btn",type:"submit",children:"Save"})]})]}),(0,n.jsxs)("section",{className:"devgigs__section devgigs__section--forecast",children:[(0,n.jsx)("h2",{children:"Suggestions by Day"}),(0,n.jsx)("ul",{className:"devgigs__forecast-list",children:E.map(e=>{let{date:t,emoji:a,description:s,suggestions:i}=e;return(0,n.jsxs)("li",{className:"devgigs__forecast-item",children:[(0,n.jsxs)("span",{className:"devgigs__forecast-date",children:[(0,n.jsx)("strong",{children:t})," – ",a," ",s]}),i.length>0?(0,n.jsx)("ul",{className:"devgigs__activity-list",children:i.map(e=>{let t=o.b.find(t=>t.id===e.activityId);return(0,n.jsxs)("li",{className:"devgigs__activity-item",children:[(null==t?void 0:t.name)||e.activityId," ",(0,n.jsxs)("span",{className:"devgigs__activity-eval",children:["(",e.evaluation,")"]})]},e.activityId)})}):(0,n.jsx)("span",{className:"devgigs__forecast-none",children:"No suggestions for this day."})]},t)})})]}),(0,n.jsxs)("section",{className:"devgigs__section devgigs__section--events",children:[(0,n.jsx)("h2",{children:"Events You Might Enjoy"}),0===C.length&&(0,n.jsxs)("p",{className:"devgigs__no-categories",children:["You haven't selected any event categories in your preferences. Head to the ",(0,n.jsx)("strong",{children:"Interests"})," page to pick some!"]}),!j&&0===Object.values(x).flat().length&&C.length>0&&(0,n.jsx)("p",{className:"devgigs__no-events",children:"✅ No upcoming events found for your selected categories. Adjust preferences or check again later."}),(0,n.jsx)("div",{className:"devgigs__events-group",children:C.map(e=>{let t=l[e],a=x[e];return t?(0,n.jsxs)("div",{className:"devgigs__category",children:[(0,n.jsx)("h3",{className:"devgigs__category-label",children:t.label}),j?(0,n.jsx)("p",{className:"devgigs__loading",children:"Fetching events…"}):a&&0!==a.length?(0,n.jsx)("ul",{className:"devgigs__events-list",children:a.map(e=>(0,n.jsxs)("li",{className:"devgigs__event-card",children:[(0,n.jsx)("strong",{className:"devgigs__event-title",children:e.name}),(0,n.jsx)("br",{}),(0,n.jsxs)("span",{className:"devgigs__event-details",children:[new Date(e.date).toLocaleString()," at"," ",(0,n.jsx)("a",{href:"https://www.google.com/maps/search/?api=1&query=".concat(encodeURIComponent(e.venue+", "+e.city)),target:"_blank",rel:"noopener noreferrer",className:"devgigs__event-venue-link",children:e.venue})]}),(0,n.jsx)("br",{}),(0,n.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"devgigs__event-link",children:"Event details →"})]},e.id))}):(0,n.jsx)("p",{className:"devgigs__no-events-category",children:"No events found in this category."})]},e):null})})]})]}):null}},9772:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dev-gigs",function(){return a(1330)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(9772)),_N_E=e.O()}]);