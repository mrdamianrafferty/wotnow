(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{3757:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var i=n(7876),a=n(4232),o=n(7258),r=n(3663),s=n(3974);let l=function(){let{preferences:{interests:e,location:t},setPreferences:n,preferences:l}=(0,s.HW)(),c=e||[],[d,u]=(0,a.useState)((null==t?void 0:t.name)||""),h=async()=>{try{let e=await fetch("https://api.openweathermap.org/geo/1.0/direct?q=".concat(encodeURIComponent(d),"&limit=1&appid=").concat((void 0).VITE_OPENWEATHER_KEY)),t=await e.json();if(t&&t.length>0){let{lat:e,lon:i}=t[0];n({...l,location:{name:d,lat:e,lon:i}})}else n({...l,location:{name:d}})}catch(e){n({...l,location:{name:d}})}};console.log("\uD83C\uDFE0 Home component rendered, interests:",e);let[p,m]=(0,a.useState)([]);return((0,a.useEffect)(()=>{!async function(){try{var e,n;let i=null!=(e=null==t?void 0:t.lat)?e:40.4168,a=null!=(n=null==t?void 0:t.lon)?n:-3.7038,o=await fetch("https://api.openweathermap.org/data/2.5/forecast?lat=".concat(i,"&lon=").concat(a,"&units=metric&appid=").concat("748bd0822b74e58605964652c38d0796")),r=await o.json(),s={};r.list.forEach(e=>{var t;let n=e.dt_txt.split(" ")[0];s[n]||(s[n]={entries:[],totalRain:0}),s[n].entries.push(e),(null==(t=e.rain)?void 0:t["3h"])&&(s[n].totalRain+=e.rain["3h"])});let l=Object.entries(s).slice(0,5).map(e=>{var t,n,i,a,o,r;let[s,{entries:l,totalRain:c}]=e,d=l.find(e=>e.dt_txt.includes("12:00:00"))||l[0],u=l.filter(e=>{var t;return(null==(t=e.rain)?void 0:t["3h"])&&Math.round(e.rain["3h"])>0}).map(e=>{let t=new Date(e.dt_txt).getHours();return"".concat(t,":00 ").concat(Math.round(e.rain["3h"]),"mm")});return{date:s,tempMax:Math.round(d.main.temp_max),tempMin:Math.round(d.main.temp_min),temperature:Math.round(d.main.temp),condition:d.weather[0].main,description:d.weather[0].description,icon:d.weather[0].icon,wind_speed:Math.round(3.6*d.wind.speed),rain:Math.round(null!=(a=null==(t=d.rain)?void 0:t["3h"])?a:0),snow:(null==(n=d.snow)?void 0:n["3h"])?Math.round(d.snow["3h"]):0,clouds:null!=(o=null==(i=d.clouds)?void 0:i.all)?o:null,humidity:d.main.humidity,visibility:null!=(r=d.visibility)?r:null,totalRain:Math.round(c),rainDetails:u}});m(l)}catch(e){console.error("Error fetching data:",e)}}()},[t]),p)?0===p.length?(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{children:"No forecast data available."}),(0,i.jsx)("p",{children:"We couldn't retrieve any forecast data. Please try again later or check your connection."})]}):(0,i.jsxs)("section",{children:[(0,i.jsxs)("header",{className:"site-header",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"page-title",children:"WotNow"}),(0,i.jsx)("p",{className:"page-subtitle",children:(0,i.jsx)("a",{href:"/interests",children:"What are you into?"})})]}),(0,i.jsxs)("div",{className:"location-input",children:[(0,i.jsx)("span",{children:"Location: "}),(0,i.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Enter city name"}),(0,i.jsx)("button",{onClick:h,children:"Save"})]})]}),(0,i.jsx)("section",{className:"main-grid",children:p.map((e,t)=>{var n,a,s,l,d,u,h;let p={temperature:null!=(a=e.temperature)?a:Math.round((e.tempMin+e.tempMax)/2),precipitation:null!=(s=e.rain)?s:0,windSpeed:null!=(l=e.wind_speed)?l:0,water_temp:null,clouds:null!=(d=e.clouds)?d:null},m=r.b;console.log("Filtered activities:",m),console.log("Weather for",e.date,":",p);let g=null!=(u=null==(n=(m.length>0?(0,o.p)({activities:m,interests:c,forecast:[{date:e.date,weather:p}]}):[])[0])?void 0:n.suggestions)?u:[];console.log("Suggestions for",e.date,":",g);let f=e.rainDetails.length>0?(0,i.jsx)(i.Fragment,{children:e.rainDetails.map(e=>{let t=e.match(/^(\d+):\d+\s+(\d+)mm$/);if(!t)return e;let n=parseInt(t[1],10),i=t[2];return 0===n?"".concat(i,"mm around midnight"):12===n?"".concat(i,"mm around noon"):"".concat(i,"mm around ").concat(n%12==0?12:n%12," ").concat(n<12?"AM":"PM")}).join(", ")}):null;return(0,i.jsxs)("article",{className:"homepage-card",children:[(0,i.jsxs)("header",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"card-title",style:{margin:0},children:0===t?"Today":1===t?"Tomorrow":new Date(e.date).toLocaleDateString("en-GB",{weekday:"long"})}),(0,i.jsx)("div",{className:"card-date",style:{fontSize:"0.9rem"},children:new Date(e.date).toLocaleDateString("en-GB",{day:"numeric",month:"long"})})]}),(0,i.jsxs)("div",{className:"card-condition",style:{fontSize:"1.2rem",fontWeight:"bold",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,i.jsx)("span",{style:{fontSize:"4rem",marginRight:"0.5rem"},children:function(e){switch(e.toLowerCase()){case"sunny":case"clear":return"☀️";case"rain":return"\uD83C\uDF27️";case"cloudy":case"clouds":return"☁️";case"snow":return"❄️";case"thunderstorm":return"⛈️";case"fog":case"mist":return"\uD83C\uDF2B️";case"drizzle":return"\uD83C\uDF26️";default:return"❔"}}(e.condition)}),(0,i.jsx)("span",{style:{fontSize:"1rem",fontWeight:"normal",textTransform:"capitalize"},children:e.description})]})]}),(0,i.jsxs)("div",{className:"card-info",children:[(0,i.jsxs)("div",{className:"temperature",style:{fontSize:"2rem",fontWeight:"bold"},children:[e.temperature,"\xb0C"]}),e.totalRain>0&&(0,i.jsxs)("div",{className:"rain-summary",children:["\uD83C\uDF27️ ",e.totalRain,"mm expected (",f,")"]}),(0,i.jsxs)("div",{className:"weather-stats",children:["\uD83D\uDCA8 ",e.wind_speed," km/h | ☁️ ",e.clouds,"% | \uD83D\uDCA7 ",e.humidity,"% | \uD83D\uDD0D ",Math.round((null!=(h=e.visibility)?h:1e4)/1e3)," km"]})]}),(0,i.jsx)("div",{className:"card-suggestions",style:{marginTop:"0.25rem"},children:g.length>0?(0,i.jsxs)("p",{children:[(0,i.jsx)("strong",{children:"Suggestions:"})," ",g.slice(0,5).map((e,t)=>{let n=r.b.find(t=>t.id===e.activityId);return(null==n?void 0:n.name)||e.activityId}).filter(Boolean).join(", ")]}):(0,i.jsxs)("p",{children:["No suggestions match your current interests for this day. ",(0,i.jsx)("a",{href:"/interests",children:"Add more interests"})," to get better suggestions!"]})})]},e.date)})})]}):(0,i.jsxs)("section",{children:[(0,i.jsx)("h2",{children:"Loading forecast data…"}),(0,i.jsx)("p",{children:"Please wait while we fetch the latest weather information."})]})}},6760:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(3757)}])},7258:(e,t,n)=>{"use strict";function i(e,t){console.debug('Evaluating single condition: "'.concat(e,'" against weather:'),t);let n={temp:"temperature",rain:"precipitation",wind_speed:"windSpeed"},i=e.match(/^([a-zA-Z_]+)=(-?\d+(?:\.\d+)?)\.\.(-?\d+(?:\.\d+)?)$/);if(i){let[,e,a,o]=i,r=parseFloat(a),s=parseFloat(o),l=n[e]||e,c="number"==typeof t[l]?t[l]:null;return null!==c&&c>=r&&c<=s}let a=e.match(/^([a-zA-Z_]+)([<>=!]+)([0-9.]+)$/);if(!a)return!1;let[,o,r,s]=a,l=parseFloat(s),c=n[o]||o,d="number"==typeof t[c]?t[c]:null;if(null===d)return!1;switch(r){case"<":return d<l;case"<=":return d<=l;case">":return d>l;case">=":return d>=l;case"=":case"==":return d===l;case"!=":return d!==l;default:return!1}}function a(e){let{forecast:t=[],interests:n=[],activities:a=[]}=e;if(console.debug("getSuggestionsByDay called with:",{forecast:t,interests:n,activities:a}),!Array.isArray(a)){if(console.error("\uD83D\uDEA8 activities argument is not an array. Received:",a),!(a&&Array.isArray(a.activities)))return[];console.warn("⚠️ Unwrapping activities.activities property"),a=a.activities}return Array.isArray(t)?t.map(e=>{let t=e.weather||{},o=[],r=[],s=[],l=[];a.forEach(a=>{let c=n.includes(a.id),d="Outdoor"===a.secondaryCategory,u="Indoor"===a.secondaryCategory;if(!c)return;let h=new Date(e.date).getMonth()+1;if(a.seasonalMonths&&!a.seasonalMonths.includes(h))return void console.debug("Activity '".concat(a.id,"' skipped because it is out of season."));if(d){let e=!1;if(a.poorConditions&&a.poorConditions.length>0&&(e=a.poorConditions.some(e=>{let n=i(e,t);return console.debug("Checking poor condition '".concat(e,"' for activity '").concat(a.id,"': ").concat(n)),n})))return void console.debug("Activity '".concat(a.id,"' skipped due to poor condition."));let n=!1;if(a.perfectConditions&&a.perfectConditions.length>0&&(n=a.perfectConditions.every(e=>{let n=i(e,t);return console.debug("Checking perfect condition '".concat(e,"' for activity '").concat(a.id,"': ").concat(n)),n}))){console.debug("Activity '".concat(a.id,"' added as perfect.")),o.push({activityId:a.id,evaluation:"perfect"});return}let l=!1;if(a.goodConditions&&a.goodConditions.length>0){let e=a.goodConditions.filter(e=>{let n=i(e,t);return console.debug("Checking good condition '".concat(e,"' for activity '").concat(a.id,"': ").concat(n)),n}).length;if(e/a.goodConditions.length>=.33){l=!0,console.debug("Activity '".concat(a.id,"' added as good (passed ").concat(e,"/").concat(a.goodConditions.length,").")),r.push({activityId:a.id,evaluation:"good"});return}}if(!n&&!l&&!e){console.debug("Activity '".concat(a.id,"' added as acceptable.")),r.push({activityId:a.id,evaluation:"acceptable"});return}a.indoorAlternative&&s.push(a.indoorAlternative)}else u&&l.push({activityId:a.id,evaluation:"indoor"})});let c=[...o,...r];if(c.length<10&&s.length>0)for(let e of s){let t=a.find(t=>t.name===e);if(t&&(c.push({activityId:t.id,evaluation:"indoorAlternative"}),c.length>=10))break}if(c.length<10&&l.length>0){for(let e of l)if(c.push(e),c.length>=10)break}return{date:e.date,suggestions:c.slice(0,10)}}):(console.error("\uD83D\uDEA8 forecast argument is not an array. Received:",t),[])}n.d(t,{p:()=>a})}},e=>{var t=t=>e(e.s=t);e.O(0,[663,636,593,792],()=>t(6760)),_N_E=e.O()}]);