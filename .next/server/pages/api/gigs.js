"use strict";(()=>{var e={};e.id=165,e.ids=[165],e.modules={3480:(e,t,n)=>{e.exports=n(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},5941:(e,t,n)=>{n.r(t),n.d(t,{config:()=>l,default:()=>c,routeModule:()=>d});var r={};n.r(r),n.d(r,{default:()=>u});var s=n(3480),a=n(8667),o=n(6435);let i=new Set(["Alternative","Blues","Classical","Country","Dance","Electronic","Folk","Hip-Hop/Rap","Jazz","Latin","Metal","Pop","R&B","Reggae","Rock","Soul","World"]);async function u(e,t){let{city:n,category:r="",venues:s="",genres:a=""}=e.query,o=process.env.TICKETMASTER_API_KEY;if(!o)return console.error("❌ Missing Ticketmaster API key"),t.status(500).json({error:"Missing API key"});let u=new URLSearchParams({apikey:o,size:"20"});"string"==typeof n&&u.append("city",n),u.append("countryCode","GB"),"string"==typeof r&&u.append("segmentId",r),"string"==typeof s&&/^[A-Za-z0-9,]+$/.test(s)?u.append("venueId",s):s&&console.warn("⚠️ venues query ignored — likely names not IDs"),"string"==typeof a&&u.append("segmentName",a);try{let e,r=await fetch(`https://app.ticketmaster.com/discovery/v2/events.json?${u.toString()}`),s=await r.text();console.log(`🎟️ Ticketmaster response:`,s.slice(0,500));try{e=JSON.parse(s)}catch(e){return console.error(`❌ Failed to parse Ticketmaster response as JSON`,e),t.status(500).json({error:"Invalid response from Ticketmaster"})}if(!e._embedded?.events)return console.log(`⚠️ No events found for ${n}`),t.status(200).json([]);let a=e._embedded.events.map(e=>{let t=(e.classifications||[]).map(e=>e.genre?.name).filter(e=>!!e).filter(e=>i.has(e));return{date:function(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric"})}(e.dates?.start?.localDate||""),artist:e.name,venue:e._embedded?.venues?.[0]?.name||"",genres:t}});t.status(200).json(a)}catch(e){console.error(`❌ Error fetching events:`,e),t.status(500).json({error:"Failed to fetch events"})}}let c=(0,o.M)(r,"default"),l=(0,o.M)(r,"config"),d=new s.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/gigs",pathname:"/api/gigs",bundlePath:"",filename:""},userland:r})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=5941);module.exports=n})();