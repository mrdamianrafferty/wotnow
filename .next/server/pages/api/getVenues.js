"use strict";(()=>{var e={};e.id=929,e.ids=[929],e.modules={3480:(e,t,n)=>{e.exports=n(5600)},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6243:(e,t,n)=>{n.r(t),n.d(t,{config:()=>l,default:()=>u,routeModule:()=>d});var r={};n.r(r),n.d(r,{default:()=>i});var o=n(3480),s=n(8667),a=n(6435);async function i(e,t){let n,r,{city:o,countryCode:s,category:a}=e.query,i=process.env.TICKETMASTER_API_KEY;if(!i||!o)return t.status(400).json({error:"Missing API key or city"});try{let e=`https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(o)}&format=json&limit=1&addressdetails=1`;s&&(e+=`&countrycodes=${encodeURIComponent(s)}`);let a=await fetch(e),i=await a.json();if(!(i.length>0)||!i[0].lat||!i[0].lon)return t.status(404).json({error:"Could not determine lat/lon for city"});n=parseFloat(i[0].lat),r=parseFloat(i[0].lon)}catch{return t.status(500).json({error:"Geocoding failed"})}console.log(`ðŸ“ Fetching venues for latlong: ${n},${r} with radius 60km`);try{let e=`https://app.ticketmaster.com/discovery/v2/venues.json?apikey=${i}&latlong=${n},${r}&radius=60&size=100`,o=await fetch(e),s=await o.json();if(!s._embedded?.venues)return t.status(404).json({error:"No venues found"});let u=s._embedded.venues.filter(e=>{let t=(e.name||"").toLowerCase();return"ticketmaster shop"!==t&&"ticketmaster merchandise"!==t&&!t.startsWith("live nation")}).map(e=>({id:e.id||null,name:e.name||"",address:e.address?.line1||null,city:e.city?.name||null,country:e.country?.name||null})),l="string"==typeof a?a:"All";if(!l||"All"===l){let e=u.sort((e,t)=>e.name.localeCompare(t.name));return t.status(200).json({venues:e})}if(!["Music","Sports","Arts & Theatre","All"].includes(l))return t.status(400).json({error:"Unsupported category"});let d=`https://app.ticketmaster.com/discovery/v2/events.json?apikey=${i}&latlong=${n},${r}&radius=60&classificationName=${encodeURIComponent(l)}&size=100`,c=await fetch(d),m=await c.json();if(!m._embedded?.events)return t.status(404).json({error:"No events found in this category"});let p=new Set(m._embedded.events.map(e=>e._embedded?.venues?.[0]?.id).filter(Boolean)),f=u.filter(e=>p.has(e.id)).sort((e,t)=>e.name.localeCompare(t.name));t.status(200).json({venues:f})}catch(e){console.error("Ticketmaster API failed:",e),t.status(500).json({error:"Failed to fetch venues from Ticketmaster"})}}let u=(0,a.M)(r,"default"),l=(0,a.M)(r,"config"),d=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/getVenues",pathname:"/api/getVenues",bundlePath:"",filename:""},userland:r})},6435:(e,t)=>{Object.defineProperty(t,"M",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},8667:(e,t)=>{Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n}});var n=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=6243);module.exports=n})();